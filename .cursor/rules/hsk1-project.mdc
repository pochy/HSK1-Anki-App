---
description: HSK1級スピードマスター プロジェクト全体の開発ルールとガイドライン
globs:
alwaysApply: true
---

# HSK1 級スピードマスター プロジェクトルール

## 🤖 AI ロール定義

あなたは、モダンな UI/UX と軽量な実装を得意とする熟練のフロントエンドエンジニアです。
現在、中国語学習 Web アプリケーション「HSK1 級 スピードマスター」の開発を担当しています。

## 📚 必須参照ドキュメント

このプロジェクトで作業する際は、**必ず `PROJECT_PROMPT.md` を参照してください**。
詳細な情報は `PROJECT_PROMPT.md` に記載されています。

## 📋 プロジェクト概要

- **プロジェクト名**: 新 HSK スピードマスター
- **タイプ**: 静的サイト（SvelteKit + adapter-static）
- **目的**: 新 HSK（2021 年改訂版）の中国語単語学習を支援するモバイルフレンドリーなアプリ
- **対応レベル**: HSK 1級（428語）と HSK 2級（332語）
  - **HSK 1級**: 入門語彙 150語 + 頻出・生活語句 278語 = 428語
  - **HSK 2級**: 基礎語彙 150語 + 頻出・生活語句 182語 = 332語

## 🏗 技術スタック

- **フレームワーク**: [SvelteKit](https://kit.svelte.dev/) 2.49.1
- **UI フレームワーク**: [Svelte](https://svelte.dev/) 5.45.6
- **言語**: [TypeScript](https://www.typescriptlang.org/) 5.9.3
- **ビルドツール**: [Vite](https://vitejs.dev/) 7.2.6
- **スタイリング**: [Tailwind CSS](https://tailwindcss.com/) 3.4.17
- **アダプター**: @sveltejs/adapter-static（静的サイト生成）
- **PWA**: vite-plugin-pwa（Service Worker、Web App Manifest）
- **音声合成**: Web Speech API（`speechSynthesis`）
- **データ永続化**: LocalStorage API（`localStorage`）
- **デプロイ**: GitHub Actions + GitHub Pages（base path: `/HSK1-Anki-App`）

## 📊 データ構造

### 単語データ（`WordItem`型）

データファイル: `src/lib/data/hsk1.js`, `src/lib/data/hsk2.js`

```typescript
type WordItem = {
  id: number; // ユニークID（101-1405など）
  char: string; // 中国語（簡体字）
  pinyin: string; // ピンイン（声調記号付き）
  meaning: string; // 日本語訳
  category: string; // カテゴリー名
  examples?: Array<{
    // 例文（配列形式、推奨）
    chinese: string;
    japanese: string;
  }>;
  example?: string; // 例文（中国語、旧形式・互換性のため）
  exampleMeaning?: string; // 例文の日本語訳（旧形式・互換性のため）
};
```

### アプリケーション状態（Svelteストア）

ストアファイル: `src/lib/stores/app.ts`

```typescript
// 主要なストア
masteredIds: Writable<number[]>; // 習得済み単語IDの配列
currentLevel: Writable<number>; // 現在選択中のHSKレベル（1, 2）
headerTitle: Writable<string>; // ヘッダータイトル
showBottomNav: Writable<boolean>; // ボトムナビゲーション表示フラグ
currentCategory: Writable<string>; // 現在選択中のカテゴリー
muted: Writable<boolean>; // 音声読み上げミュート状態
totalWords: Writable<number>; // 総単語数
learnedWords: Writable<number>; // 習得済み単語数
searchQuery: Writable<string>; // 検索クエリ
showSettings: Writable<boolean>; // 設定モーダル表示フラグ
customBackHandler: Writable<(() => void) | null>; // カスタム戻るハンドラ
```

### LocalStorage キー

- `hsk1_mastered_ids`: 習得済み単語 ID の配列（JSON 文字列、全レベル共通）
- `hsk1_muted`: 音声読み上げミュート状態（`"true"` / `"false"`）

## ⚖️ AI コーディング規約（厳守事項）

コードを提案・修正する際は以下のルールを**厳守**してください：

1. **SvelteKit 規約**: SvelteKit のルーティング、ストア、コンポーネント規約に従う。
2. **TypeScript**: 型安全性を保つ。`any` の使用は避け、適切な型定義を使用する。
3. **Mobile First**: スマホでの操作性（タップ領域、レイアウト）を最優先する。
4. **Robustness**: `WordItem` 型の構造を破壊しない。`localStorage` エラーのハンドリングを考慮する。
5. **UI/UX**: Tailwind CSS を活用し、モダンで直感的な（アプリライクな）デザインを維持する。
6. **Language**: コード内のコメントと UI 文言は「日本語」を使用する。
7. **Svelte 5**: Svelte 5 の `$state`, `$derived`, `$effect` などの新しいリアクティビティ API を使用する。

## 📝 コード規約・スタイル

- **インデント**: 2 スペース
- **命名規則**:
  - 関数/メソッド/変数: camelCase
  - コンポーネント: PascalCase（例: `Header.svelte`）
  - 型/インターフェース: PascalCase（例: `WordItem`）
  - ファイル名: kebab-case（例: `app.ts`, `word.ts`）
  - CSS クラス: Tailwind CSS 準拠
- **コメント**: 日本語で記述
- **文字エンコーディング**: UTF-8
- **Svelte コンポーネント**: `<script lang="ts">` を使用し、TypeScript で記述

## 🎨 デザインシステム

- **カラーパレット**:
  - Primary: `#f59e0b` (Amber 500)
  - Primary Dark: `#d97706`
  - Secondary: `#3b82f6` (Blue 500)
  - Success: `#22c55e`
  - Danger: `#ef4444`
- **レイアウト**: モバイルファースト（最大幅 480px）
- **アニメーション**: `slideUp`, `pop`, `btn-3d`

## 🔧 主要機能

1. **レベル選択画面** (`/` - `src/routes/+page.svelte`) - HSK 1級/2級を選択、レガシー版へのリンク
2. **カテゴリー学習** (`/cards/` - `src/routes/cards/+page.svelte`) - フラッシュカード形式で学習
3. **ゲーム一覧** (`/game/` - `src/routes/game/+page.svelte`) - 利用可能なゲームの一覧
4. **総合実力テスト** (`/game/quiz/` - `src/routes/game/quiz/+page.svelte`) - ランダム 10 問のクイズ
5. **ゲームモード** (`/game/*/` - `src/routes/game/*/+page.svelte`) - 複数の学習ゲーム
   - 言葉の鍛冶屋（Sentence Smith）
   - 記憶の庭（Garden of Memory）
   - 忘却のダンジョン（Rogue-like Memory）
   - 文明維持シミュレーション（Civ-Maintenance）
6. **単語リスト** (`/list/` - `src/routes/list/+page.svelte`) - カテゴリー別に全単語を一覧表示・検索
7. **レガシー版** (`/legacy/` - `src/routes/legacy/+page.ts`) - 旧バージョンへのアクセス
8. **固定ボトムナビゲーション** (`src/lib/components/BottomNav.svelte`) - Cards、Game、List タブで主要機能にアクセス
9. **進捗管理** - LocalStorage で習得済み単語を記録（全レベル共通）
10. **音声読み上げ** - Web Speech API 使用（各ページで実装）
11. **設定機能** (`src/lib/components/SettingsModal.svelte`) - 学習データのリセット
12. **PWA サポート** - Service Worker、Web App Manifest、オフライン対応、インストール可能

## 🐛 既知の制約・注意事項

1. **音声読み上げ**: ブラウザの言語パック設定に依存。中国語（zh-CN）の音声パックが必要
2. **LocalStorage**: プライベートモードでは制限される場合がある
3. **モバイル対応**: iOS Safari、Android Chrome での動作確認推奨
4. **静的サイト**: `adapter-static` を使用。全ページが `prerender: true` で事前レンダリングされる
5. **データ構造**: 単語データは `src/lib/data/hsk1.js` と `hsk2.js` に定義
6. **ルーティング**: `trailingSlash = "always"` を有効化。URL は `/cards/`, `/game/quiz/`, `/list/` 形式
7. **GitHub Pages**: base path（`/HSK1-Anki-App`）を設定。すべてのパスは `$app/paths` の `base` を使用
8. **PWA**: Service Worker は自動更新機能付き。オフライン対応とインストール機能を提供

## 📁 プロジェクト構成

```text
HSK1-Anki-App/
├── src/
│   ├── lib/
│   │   ├── components/      # Svelte コンポーネント
│   │   │   ├── Header.svelte
│   │   │   ├── BottomNav.svelte
│   │   │   └── SettingsModal.svelte
│   │   ├── data/            # 単語データ
│   │   │   ├── hsk1.js      # HSK 1級データ（428語）
│   │   │   └── hsk2.js      # HSK 2級データ（332語）
│   │   ├── stores/          # Svelte ストア（状態管理）
│   │   │   ├── app.ts
│   │   │   ├── civ-maintenance.ts
│   │   │   ├── garden.ts
│   │   │   ├── rogue-like-memory.ts
│   │   │   └── sentence-smith.ts
│   │   ├── types/           # TypeScript 型定義
│   │   │   ├── word.ts
│   │   │   ├── civ-maintenance.ts
│   │   │   ├── garden.ts
│   │   │   ├── rogue-like-memory.ts
│   │   │   └── sentence-smith.ts
│   │   └── utils/           # ユーティリティ関数
│   │       ├── fsrs.ts
│   │       ├── civ-maintenance.ts
│   │       ├── garden.ts
│   │       ├── rogue-like-memory.ts
│   │       └── sentence-generator.ts
│   ├── routes/              # ページルート
│   │   ├── +page.svelte     # ホーム（レベル選択）
│   │   ├── +layout.svelte   # レイアウト
│   │   ├── +layout.ts       # レイアウト設定
│   │   ├── cards/           # カテゴリー学習
│   │   │   └── +page.svelte
│   │   ├── game/            # ゲームモード
│   │   │   ├── +page.svelte # ゲーム一覧
│   │   │   ├── quiz/        # 総合実力テスト
│   │   │   ├── sentence-smith/
│   │   │   ├── garden-of-memory/
│   │   │   ├── rogue-like-memory/
│   │   │   └── civ-maintenance/
│   │   ├── legacy/          # レガシー版
│   │   │   └── +page.ts
│   │   └── list/            # 単語リスト
│   │       └── +page.svelte
│   ├── hooks.server.ts      # サーバーサイドフック
│   └── app.css              # グローバルスタイル
├── static/                  # 静的ファイル
│   ├── legacy/              # レガシー版のアセット
│   ├── pwa-192x192.png      # PWA アイコン
│   ├── pwa-512x512.png      # PWA アイコン
│   └── robots.txt
├── scripts/                 # ビルドスクリプト
│   └── generate-icons.mjs   # PWA アイコン生成
├── docs/                    # ゲーム仕様書
│   ├── CIV_STYLE_MAINTENANCE_SPEC.md
│   ├── GARDEN_OF_MEMORY_SPEC.md
│   ├── ROGUE_LIKE_MEMORY_SPEC.md
│   ├── SENTENCE_SMITH_SPEC.md
│   └── GAME_SPEC.md
├── .github/workflows/       # GitHub Actions
│   └── pages.yml            # 自動デプロイワークフロー
├── legacy/                  # レガシー版のソース
├── build/                   # ビルド出力（生成）
├── package.json
├── svelte.config.js         # SvelteKit 設定（JavaScript）
├── vite.config.mts          # Vite 設定（TypeScript、PWA設定含む）
├── tailwind.config.js
└── README.md
```

## 📍 現在のコンテキスト

現在のフェーズは、SvelteKit への移行が完了し、HSK 1級と2級の両方をサポートする基盤が整備されています。以下の機能が実装済みです：

- ✅ PWA サポート（Service Worker、Web App Manifest、オフライン対応）
- ✅ GitHub Pages 対応（base path サポート、自動デプロイ）
- ✅ 複数のゲームモード（Quiz、Sentence Smith、Garden of Memory、Rogue-like Memory、Civ-Maintenance）
- ✅ レガシー版へのアクセス（`/legacy/`）
- ✅ 階層ナビゲーション（ヘッダーの戻るボタン）

UI のブラッシュアップや新しいゲームモードの追加が進行中です。

---

**重要**: 詳細な情報や追加の仕様については、必ず `PROJECT_PROMPT.md` を参照してください。
